name: Actualizar Lista de Repositorios

on:
  # Se ejecuta manualmente (útil para la primera prueba)
  workflow_dispatch:
  # Se ejecuta automáticamente todos los días a la medianoche UTC
  schedule:
    - cron: '0 0 * * *' 
  # Se ejecuta cada vez que haces un push al branch principal (main)
  push:
    branches:
      - main
      - master

jobs:
  generate_repository_list:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Código
        uses: actions/checkout@v4
        
      - name: Generar Lista de Repositorios
        uses: varunsridharan/action-repository-list-generator@v1
        with:
          # Usamos tu nombre de usuario de GitHub
          user_name: 'Onigp' 
          # Definimos dónde empieza y termina la inserción en el README
          token: ${{ secrets.GITHUB_TOKEN }}
          # Excluye el repositorio de perfil, ya que no es un proyecto de código
          exclude: 'Onigp'
          # Título de la sección
          heading: '## Proyectos Activos' 
          # Formato de salida (lista no ordenada)
          output_type: 'ul' 
          
      - name: Commit y Push del README Actualizado
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add README.md
          git commit -m "chore(readme): Auto-actualización de la lista de repositorios" || echo "No hay cambios en el README.md"
          git push
